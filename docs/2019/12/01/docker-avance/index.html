<!DOCTYPE html><html lang="en"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Docker avancÃ© | btor.fr</title><meta name="description" content="PassionnÃ© d'informatique, de dÃ©veloppement web & applicatif depuis plus de 10 ans. Je partage mon quotidien de tech ! "><meta itemprop="name" content="Thibaut BAYER"><meta itemprop="description" content="PassionnÃ© d'informatique, de dÃ©veloppement web & applicatif depuis plus de 10 ans. Je partage mon quotidien de tech ! "><meta itemprop="image" content="https://btor.fr/assets/images/docker-pratique-outils/main.png"><meta property="og:url" content="https://btor.fr/2019/12/01/docker-avance/"><meta property="og:type" content="website"><meta property="og:title" content="Docker avancÃ© | btor.fr"><meta property="og:site_name" content="btor.fr"><meta property="og:description" content="PassionnÃ© d'informatique, de dÃ©veloppement web & applicatif depuis plus de 10 ans. Je partage mon quotidien de tech ! "><meta property="og:image" content="https://btor.fr/assets/images/docker-pratique-outils/main.png"><meta name="twitter:url" content="https://btor.fr/2019/12/01/docker-avance/"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Docker avancÃ© | btor.fr"><meta name="twitter:site" content="btor.fr"><meta name="twitter:description" content="PassionnÃ© d'informatique, de dÃ©veloppement web & applicatif depuis plus de 10 ans. Je partage mon quotidien de tech ! "><meta name="twitter:creator" content="@biiitor"><meta property="twitter:image" content="https://btor.fr/assets/images/docker-pratique-outils/main.png"><link rel="icon" type="image/x-icon" href="/assets/images/favicon.ico"><link rel="stylesheet" href="/assets/css/app.min.css"><link rel="alternate" type="application/rss+xml" title="btor.fr" href="/feed.xml"><link rel="canonical" href="/2019/12/01/docker-avance/"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-153641953-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-153641953-1'); </script></head><body id="docker-avancÃ©" class="post-layout"><header class="header"> <a class="header__title" href="https://btor.fr/"><img width="75" src="/assets/images/logo/logo.dark.small.png"/></a><nav><ul class="header__list"><li><a href="/qui-suis-je">â“ Qui suis-je</a></li><li><a href="/help">â¤ï¸ Me soutenir</a></li></ul></nav></header><main class="ğŸ’ˆ"><div class="post"><article itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting"><div class="post__header section-padding--double"><div class="grid-small"><h2 itemprop="name headline">Docker avancÃ©</h2><time class="post__date" datetime="2019-12-01T00:00:00-06:00" itemprop="datePublished">01/12/2019</time></div></div><div class="post__img"><div><figure class="absolute-bg" style="background-image: url('/assets/images/docker-pratique-outils/main.png');"></figure></div></div><div class="post__content section-padding"><div class="grid"><div id="markdown" itemprop="articleBody"><p>Dans mon dernier article je vous expliquais les bases de docker, partons du principe que vous avez donc ces bases (docker push/pull/exec/ps/killâ€¦) et que vous dÃ©sirez aller un peu plus loin avec Docker. Il vous manque surement Ã©normÃ©ment dâ€™informations pour vraiment utiliser Docker, dans cet article jâ€™y rÃ©pondrais et vous aurez de quoi avoir votre premiÃ¨re stack docker fonctionnelle (promis ca ne sera pas long, seulement 223 pages Ã©hÃ©h).</p><p>CommenÃ§ons par nous poser la bonne question, pourquoi utiliser Docker ? <em>Il parait que câ€™est cool</em></p><p>Dans quel contexte ? <em>Ma stack de dev ? en production ?</em></p><p>RÃ©pond t-il a tout nos besoins ? <em>Surement pas</em></p><p>La conteneurisation va nous permettre de lancer des processus dans un environnement cloisonnÃ© (oui je sais, je me rÃ©pÃ¨te). Autrement dit, si vous avez lâ€™habitude dâ€™installer votre stack local Ã  la main, Ã  base de <code class="highlighter-rouge">apt install apache2 ... </code> ou autre, vous ne voyez surement pas lâ€™intÃ©rÃªt de passer sur docker et pourtant ! dans Ã©normÃ©ment de cas docker peut vous aider. Jâ€™ai eu rÃ©cemment le cas au travail oÃ¹ un dÃ©veloppeur mobile ne connaissait pas Docker (ou juste de nom) et ne lâ€™utilisait pas parcequâ€™il en voyait pas forcÃ©ment lâ€™utilitÃ©. En ayant pris connaissance des fonctionnalitÃ©s apportÃ©es par Docker ainsi quâ€™une petite prÃ©sentation bien ficelÃ©e ( #JaiUnMelonHorsNorme ), il a fini par trouvÃ© Docker indispensable.</p><p>Voici quelques exemples dâ€™utilisations de docker :</p><ul><li>En tant que dÃ©veloppeur web, vous avez votre bon vieux LAMP (Linux, Apache, Mysql, Php) classique, câ€™est cool mais comment font les nouveaux dÃ©vs quand ils arrivent dans votre team ? Ils rÃ©installent la stack complÃ¨te Ã  la main ? Quid du dÃ©veloppeur qui utilise mac alors que toi tu utilises Windows ? Câ€™est Ã  ce moment lÃ  que Docker est utile, un fichier de configuration pour tout le monde et en 2 clicks, la stack est montÃ©e.</li><li>En tant que devsOps, tu es souvent amenÃ© Ã  alterner entre Python et Go, puis parfois, tu as besoin de gÃ©rer plusieurs versions de python, de go, au sein de la mÃªme machine. Pourquoi sâ€™embÃªter avec une installation manuelle quand tu peux juste faire un <code class="highlighter-rouge">docker run golang:1.11.11</code> <code class="highlighter-rouge">docker run golang:1.12.6</code> <code class="highlighter-rouge">docker run python:2.7-stretch</code> <code class="highlighter-rouge">docker run python:3.7.3-stretch</code> ?</li><li>En tant que pentester vous utilisez diffÃ©rents outils dâ€™intrusion et vous travaillez sur une faille PhpMyAdmin, comment tester facilement votre exploit sur diffÃ©rentes versions ? DOCKERRRRRRR</li></ul><p>Des exemples comme ceux-lÃ  il en existe un paquet, le plus important nâ€™est pas dâ€™utiliser docker parce que câ€™est sexy mais dâ€™arriver Ã  comprendre ce quâ€™il va vous apporter.</p><h1 id="ï¸-docker-en-stack-de-dÃ©veloppement">âš™ï¸ Docker en stack de dÃ©veloppement</h1><p>Maintenant que nous avons les diffÃ©rents cas dâ€™utilisation, prenons un des cas qui mâ€™a concernÃ© et qui est surement LE cas par excellence de docker : La stack de dÃ©veloppement</p><p>Historiquement, on tÃ©lÃ©chargeait notre petit LAMP, MAMP, WAMP et on dÃ©veloppait dans notre coin pÃ©pouze. Ca marche mais câ€™est vite chiant, on peut souvent avoir un soucis isolÃ© dâ€™un autre dÃ©v parcequâ€™il nâ€™est pas sur le mÃªme systÃ¨me dâ€™exploitation, nâ€™a pas mis la mÃªme configuration etc.. GrÃ¢ce Ã  Docker, on va avoir la mÃªme configuration, cross-platform et surtout on aura tous les mÃªmes erreurs de merde quand Ã§a plantera ET CA Câ€™EST COOL ! @@LUL</p><p><img src="https://media.giphy.com/media/3oxRmGXbquXKz6DNPq/giphy.gif" alt="" /></p><h2 id="ï¸-le-besoin">âœï¸ Le besoin</h2><p>On va prendre en compte une stack de dÃ©veloppement web classique, un bon vieux LAMP ! On a donc besoin :</p><ul><li>Dâ€™un serveur web, apache ou nginx</li><li>Dâ€™un process PHP-FPM</li><li>Dâ€™une base MySQL, PostgreSQL ou autre</li></ul><p>La premiÃ¨re chose Ã  faire dans ce cas lÃ  est de rechercher si les technos sont disponibles sur Docker (via le docker hub).</p><p>AprÃ¨s recherche, on trouve donc :</p><ul><li><a href="https://hub.docker.com/_/php">PHP</a></li><li><a href="https://hub.docker.com/_/mysql">MySQL</a></li><li><a href="https://hub.docker.com/_/nginx">NginX</a></li></ul><p>Bingo, on a dÃ©jÃ  de quoi faire pour crÃ©er notre stack. @@HEY</p><h2 id="ï¸-la-pratique">ğŸ› ï¸ La pratique</h2><p>Je vous lâ€™avais expliquÃ© dans lâ€™article prÃ©cÃ©dent, pour lancer un conteneur on utilise <code class="highlighter-rouge">docker run</code> oui mais voilÃ , câ€™est vrai mais je vous ai lÃ©gÃ¨rement mentiâ€¦</p><p><img src="https://media.giphy.com/media/2emoe1XUg23rW/giphy.gif" alt="" /></p><p><code class="highlighter-rouge">docker run</code> rÃ©cupÃ¨re et lance une image docker, câ€™est vraiâ€¦ mais imaginez si on devait faire Ã§a pour tous les processus que vous utilisez ? Ã‡a serait vite chiant ! <code class="highlighter-rouge">docker run php &amp;&amp; docker run mysql &amp;&amp; docker run nginx</code> etcâ€¦ Puis comme je vous lâ€™ai dit, les conteneurs ont une durÃ©e de vie limitÃ©, on les lance, ils sâ€™arrÃªtent et la donnÃ©e Ã  lâ€™intÃ©rieur de celui-ci est effacÃ©e. Comment faire pour utiliser une base de donnÃ©e ? ou mÃªme juste votre code source pour quâ€™il soit interprÃ©tÃ© par PHP ?</p><p>En rÃ©alitÃ©, Docker ne se limite pas Ã  4 commandes push/run/pull/exec, vous pouvez gÃ©rer bien plus de choses comme le rÃ©seau entre vos conteneurs, monter des volumes de fichiers, gÃ©rer vos entrÃ©es /etc/hosts etc..</p><p>Câ€™est exactement la mÃªme chose que la configuration dâ€™une machine virtuelle sauf quâ€™on enlÃ¨ve lâ€™aspect "matÃ©riel", on ne gÃ¨re pas la mÃ©moire quâ€™on attribue Ã  notre conteneur, ni mÃªme son espace disque. Par contre, on peut gÃ©rer lâ€™espace disque ou la mÃ©moire quâ€™on alloue Ã  la machine virtuelle docker (dans le cas dâ€™un DockerForMac par exemple)</p><p><img src="/assets/images/docker-pratique-outils/settings.png" alt="" /></p><p>CommenÃ§ons par la crÃ©ation du conteneur nginx, notre process nginx va avoir besoin dâ€™une configuration de base pour fonctionner (bah ouai, il faut bien quâ€™il sache oÃ¹ est notre code source et comment il doit lâ€™interprÃ©ter)</p><p><em>Pour faciliter la relecture et la comprÃ©hension, tous les extraits de code ou de configuration sont disponibles sur <a href="https://github.com/bt0r/docker-article">ce repo github</a></em></p><p>Revenons sur lâ€™image docker que jâ€™ai crÃ©e:</p><div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="s"> nginx:1.17.1-alpine</span>

<span class="k">RUN </span><span class="nb">mkdir</span> <span class="nt">-p</span> /var/www/btor.fr

<span class="k">COPY</span><span class="s"> ./config/btor.fr /etc/nginx/sites-available/</span>

<span class="k">WORKDIR</span><span class="s"> /var/www/btor.fr</span>
</code></pre></div></div><p><em>Je ne reviens pas sur le dÃ©tail du fichier de configuration nginx, câ€™est un fichier basique</em></p><p>Avec cette image, on voit bien quâ€™il nâ€™y a rien dedans, on rÃ©cupÃ¨re juste nginx, on copie un fichier de configuration, on crÃ©e le rÃ©pertoire <code class="highlighter-rouge">/var/www/btor.fr</code> et on le dÃ©finit comme rÃ©pertoire par dÃ©faut. Parfait, mais comment dire Ã  nginx dâ€™afficher notre page web ?</p><p>La solution est de monter un volume pour que ces fichiers soient non pas copiÃ©s mon montÃ©s Ã  la volÃ©e.</p><ul><li>Rendez vous dans votre rÃ©pertoire <code class="highlighter-rouge">docker/nginx</code></li><li>Taper <code class="highlighter-rouge">docker build . -t btor/nginx</code></li><li>Puis <code class="highlighter-rouge">docker run -d -v ~/www/docker-article/web:/var/www/btor.fr btor/nginx</code> (attention au chemin du rÃ©pertoire web)</li></ul><p>Votre conteneur devrait se lancer et afficher un hash (qui correspond Ã  lâ€™ID du conteneur). VÃ©rifions avec un <code class="highlighter-rouge">docker ps</code> :</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES
e4c925076a14        btor/nginx          \"nginx -g 'daemon ofâ€¦\"   4 seconds ago       Up 3 seconds        80/tcp                   relaxed_wescoff
</code></pre></div></div><p>Notre conteneur nginx fonctionne bien, le volume Ã  lâ€™air dâ€™avoir Ã©tÃ© pris en compte. On va donc le vÃ©rifier :</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>btor@dev<span class="nv">$ </span>docker <span class="nb">exec</span> &lt;containerID&gt; <span class="nb">ls
</span>index.php
</code></pre></div></div><p>Bingo, le volume a bien Ã©tÃ© montÃ© et les fichiers disponibles dans <code class="highlighter-rouge">/web</code> sont bien dans le rÃ©pertoire <code class="highlighter-rouge">/var/www/btor.fr</code> du conteneur.</p><p>Maintenant que notre conteneur a bien les bons fichiers, essayons dâ€™y accÃ©der en HTTP. PremiÃ¨re Ã©tape:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>btor@deb<span class="nv">$ </span>docker <span class="nb">exec</span> &lt;container_id&gt;  wget localhost <span class="nt">-O-</span>
...
&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
&lt;p&gt;If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.&lt;/p&gt;
...
</code></pre></div></div><p>Notre conteneur nous rÃ©pond bien avec la page par dÃ©faut de NGINX mais pas de php, logique ! nous avons montÃ© un volume de fichier mais aucun conteneur PHP nâ€™existe.</p><p>Relions maintenant le conteneur nginx et PHP.</p><pre><code class="language-Dockerfile">FROM php:7.3.6-fpm-alpine

WORKDIR /var/www/btor.fr
</code></pre><p>Ports</p><p>Docker-compose</p></div><ul class="post__social"><li><a href="https://www.facebook.com/sharer/sharer.php?u=https://btor.fr/2019/12/01/docker-avance/" target="_blank"><i class="fa fa-facebook"></i></a></li><li><a href="https://twitter.com/intent/tweet?&text=Docker avancÃ©+https://btor.fr/2019/12/01/docker-avance/+by+Thibaut BAYER" target="_blank"><i class="fa fa-twitter"></i></a></li><li><a href="https://plus.google.com/share?url=https://btor.fr/2019/12/01/docker-avance/" target="_blank"><i class="fa fa-google-plus"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?mini=true&source=Docker avancÃ©&summary=&url=https://btor.fr/2019/12/01/docker-avance/" target="_blank"><i class="fa fa-linkedin"></i></a></li><li><a href="https://www.stumbleupon.com/badge/?url=https://btor.fr/2019/12/01/docker-avance/" target="_blank"><i class="fa fa-stumbleupon"></i></a></li><li><a href="https://www.reddit.com/submit?url=https://btor.fr/2019/12/01/docker-avance/" target="_blank"><i class="fa fa-reddit-alien"></i></a></li><li><a href="https://www.tumblr.com/share/link?url=https://btor.fr/2019/12/01/docker-avance/" target="_blank"><i class="fa fa-tumblr"></i></a></li><li><a href="https://www.pinterest.com/pin/create/link/?description=&media=https://btor.fr/assets/images/docker-pratique-outils/main.png&url=https://btor.fr/2019/12/01/docker-avance/" target="_blank"><i class="fa fa-pinterest"></i></a></li></ul></div></div><div class="section-padding--none"><div class="grid"><hr class="sep"/></div></div><div class="section-padding"><div class="grid-small"> <span class="post__author">PostÃ© par <a href="http://btor.fr" title="More By Thibaut BAYER">Thibaut BAYER</a></span><p class="post__bio">PassionnÃ© d'informatique, de dÃ©veloppement web & applicatif depuis plus de 10 ans. Je partage mon quotidien de tech !</p></div></div></article></div><section class="related section-padding"><div class="grid-xlarge"><h2 class="related__title"></h2><div class="related__container"><article class="related__post"> <a class="related__link" href="https://btor.fr/2019/12/01/docker-avance/"><figure class="related__img"> <img src="/assets/images/docker-pratique-outils/main.png" alt="Docker avancÃ©"/></figure><div><h2 class="related__text">Docker avancÃ©</h2></div></a></article><article class="related__post"> <a class="related__link" href="https://btor.fr/2019/07/03/docker-bases-tuto/"><figure class="related__img"> <img src="/assets/images/docker-bases/main.png" alt="Docker, les bases"/></figure><div><h2 class="related__text">Docker, les bases</h2></div></a></article></div></div></section></main><footer class="footer section-padding"><div class="grid"><div class="subscribe" id="subscribe"><div class="subscribe__container"> <span class="subscribe__title">Restons en contact</span><ul class="footer__social"><li><a href="https://twitter.com/biiitor" target="_blank"><i class="fa fa-twitter"></i></a></li><li><a href="https://www.instagram.com/btor.fr/" target="_blank"><i class="fa fa-instagram"></i></a></li><li><a href="https://www.linkedin.com/in/thibaut-bayer//" target="_blank"><i class="fa fa-linkedin"></i></a></li><li><a href="https://github.com/bt0r" target="_blank"><i class="fa fa-github"></i></a></li><li><a href="https://twitch.tv/bt0r" target="_blank"><i class="fa fa-twitch"></i></a></li></ul></div></div><hr class="sep--white"/><div class="footer__container"><p>CatÃ©gories</p><ul class="footer__tags"><li><a class="footer__link" href="/tag/materiel">Materiel</a></li><li><a class="footer__link" href="/tag/test">Test</a></li><li><a class="footer__link" href="/tag/infrastructure">Infrastructure</a></li><li><a class="footer__link" href="/tag/tutorial">Tutorial</a></li><li><a class="footer__link" href="/tag/photos--vido">Photos & VidÃ©o</a></li></ul></div></div></footer><section class="contact popup"><div class="popup__close"><div class="popup__exit"></div></div><div class="contact__container popup__container"><div class="contact__img"><figure class="absolute-bg" style="background-image: url(/assets/images/logo/logo.dark.small.png);"></figure></div><div class="contact__content"><div class="contact__mast section-padding--half"><div class="grid"><h2>Contact</h2></div></div><div class="section-padding--none"><hr class="sep"/></div><div class="contact__form section-padding--half"><div class="grid-xlarge"> <form id="form" class="form" action="https://formcarry.com/s/HkIo0nMb7" method="POST"><div class="form__subcontainer"><div> <label for="form-first-name">First Name</label> <input type="text" name="first-name" id="form-first-name" required></div><div> <label for="form-last-name">Last Name</label> <input type="text" name="last-name" id="form-last-name" required></div></div><div> <label for="form-email">E-Mail</label> <input type="email" name="email" id="form-email" required></div><div> <label for="form-message">Message</label> <textarea name="message" id="form-message" rows="3"></textarea></div><div class="form__submit"><div class="form__btn"> <input type="submit" value="Send"></div></div><p class="form__message"></p></form></div></div></div></div></section><script src="/assets/js/app.min.js"></script></body></html>
  